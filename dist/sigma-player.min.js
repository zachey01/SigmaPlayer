"use strict";class SigmaPlayer{constructor(e,t={}){if(this.video="string"==typeof e?document.querySelector(e):e,!this.video)throw new Error("Видео элемент не найден");if(!this.video.closest("#sigma__video-wrapper")){const e=document.createElement("div");e.id="sigma__video-wrapper",this.video.parentNode.insertBefore(e,this.video),e.appendChild(this.video)}const i=this.video.closest("#sigma__video-wrapper");createControlsUI(i,this),this.videoWrapper=i,this.options=t,this.videoType=t.videoType||null,this.videoSources={},this.selectedTranslation=null,this.selectedQuality=null,this.autoQuality=!1,this.hls=null,this.dashPlayer=null,this.isDragging=!1,this.playEnabled=!1,this.HIDE_CONTROLS_CLASS="sigma__hide-controls",this.IS_PLAYING_CLASS="sigma__isPlaying",this.IS_MUTED_CLASS="sigma__isMute",this.IS_FULLSCREEN_CLASS="sigma__isFullscreen",this.SHOW_CLASS="sigma__show",this.longPressTimeout=null,this.longPressActivated=!1,this.initialize(),this.options.sources&&this.loadVideoSources(this.options.sources)}showSpinner=()=>{this.loadingSpinner.style.display="block"};hideSpinner=()=>{this.loadingSpinner.style.display="none"};showCentralPlay=()=>{this.centralPlayBtn.style.display="flex"};hideCentralPlay=()=>{this.centralPlayBtn.style.display="none"};formatTime=e=>formatTime(e);getNetworkSpeed=()=>getNetworkSpeed();chooseQualityBasedOnSpeed=()=>chooseQualityBasedOnSpeed();getStoredQuality=()=>getStoredQuality();storeQuality=e=>{storeQuality(e)};getStoredSpeed=()=>getStoredSpeed();storeSpeed=e=>{storeSpeed(e)};updateTabIndices=()=>{const e=this.settingsMenu.parentElement.classList.contains(this.SHOW_CLASS);this.settingsMenu.querySelectorAll(".sigma__dropdown-item").forEach((t=>{t.setAttribute("tabindex",e?"0":"-1")}));const t=this.volumeContainer.classList.contains("active");this.volumeSlider&&this.volumeSlider.setAttribute("tabindex",t?"0":"-1")};isMenuOpen=()=>this.settingsMenu&&this.settingsMenu.parentElement&&this.settingsMenu.parentElement.classList.contains(this.SHOW_CLASS)||this.volumeContainer&&this.volumeContainer.classList.contains("active");enablePlayButton=()=>{this.playBtn.disabled=!1,this.playBtn.style.opacity=1};disablePlayButton=()=>{this.playBtn.disabled=!0,this.playBtn.style.opacity=.5};togglePlayState=()=>{this.video.paused||this.video.ended?this.video.play().then((()=>{this.playBtn.classList.add(this.IS_PLAYING_CLASS)})).catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})):(this.video.pause(),this.playBtn.classList.remove(this.IS_PLAYING_CLASS))};toggleFullscreen=()=>{document.fullscreenElement?this.closeFullscreen():this.openFullscreen()};openFullscreen=()=>{this.videoWrapper.requestFullscreen?this.videoWrapper.requestFullscreen():this.videoWrapper.webkitRequestFullscreen?this.videoWrapper.webkitRequestFullscreen():this.videoWrapper.msRequestFullscreen&&this.videoWrapper.msRequestFullscreen(),this.fullScreenBtn.classList.add(this.IS_FULLSCREEN_CLASS),this.video.style.position="absolute",this.video.style.top="50%",this.video.style.left="50%",this.video.style.transform="translate(-50%, -50%)",this.video.style.maxWidth="100%",this.video.style.maxHeight="100%"};closeFullscreen=()=>{document.fullscreenElement&&document.exitFullscreen().catch((e=>{console.error("Error exiting fullscreen:",e)})),this.fullScreenBtn.classList.remove(this.IS_FULLSCREEN_CLASS),this.video.style.position="",this.video.style.top="",this.video.style.left="",this.video.style.transform="",this.video.style.maxWidth="",this.video.style.maxHeight=""};updateProgress=()=>{if(!this.isDragging&&this.video.duration){const e=this.video.currentTime/this.video.duration*100;this.progress.style.width=e+"%",this.updateTimeDisplay()}};updateTimeDisplay=e=>{const t=void 0!==e?e:this.video.currentTime,i=this.video.duration||0;this.currentTimeElem.textContent=this.formatTime(t),this.durationElem.textContent=this.formatTime(i),this.currentTimeElem.classList.add("countdown"),setTimeout((()=>this.currentTimeElem.classList.remove("countdown")),500)};updateBuffered=()=>{if(this.video.buffered.length>0){const e=this.video.buffered.end(this.video.buffered.length-1),t=this.video.duration;if(t>0){const i=e/t*100;this.progress.parentElement.querySelector(".sigma__buffered").style.width=`${i}%`}}};handleTimelineClick=e=>{if(!this.video.duration)return;const t=this.timeline.offsetWidth,i=e.offsetX/t*this.video.duration;this.video.currentTime=i};startDrag=e=>{this.isDragging=!0;const t=e.touches?e.touches[0].clientX:e.clientX;this.updateTimeline(t),this.showSeekTooltip(t)};dragTimeline=e=>{if(this.isDragging&&this.video.duration){const t=e.touches?e.touches[0].clientX:e.clientX;this.updateTimeline(t),this.showSeekTooltip(t)}};stopDrag=e=>{if(this.isDragging&&this.video.duration){this.isDragging=!1;const t=e.changedTouches?e.changedTouches[0].clientX:e.clientX;this.hideSeekTooltip(),this.updateTimeline(t);const i=(t-this.timeline.getBoundingClientRect().left)/this.timeline.offsetWidth*this.video.duration;this.video.currentTime=i}};updateTimeline=e=>{const t=this.timeline.getBoundingClientRect();let i=e-t.left;i<0&&(i=0),i>t.width&&(i=t.width);const s=i/t.width*100;this.progress.style.width=s+"%";const n=i/t.width*this.video.duration;this.updateTimeDisplay(n)};showSeekTooltip=e=>{const t=this.timeline.getBoundingClientRect();let i=e-t.left;i<0&&(i=0),i>t.width&&(i=t.width);const s=i/t.width*this.video.duration,n=this.formatTime(s);this.seekTooltip.textContent=n,this.seekTooltip.style.left=`${i}px`,this.seekTooltip.style.display="block"};hideSeekTooltip=()=>{this.seekTooltip.style.display="none"};toggleVolume=()=>{this.volumeContainer.classList.toggle("active"),this.closeOtherMenus("volume"),this.updateTabIndices()};toggleSettingsMenuFunc=e=>{e.stopPropagation(),this.settingsMenu.parentElement.classList.toggle(this.SHOW_CLASS),this.closeOtherMenus("settings"),this.updateTabIndices()};setPlaybackSpeed=e=>{this.video.playbackRate=e,this.storeSpeed(e)};checkPlayButton=()=>{this.playEnabled?this.enablePlayButton():this.disablePlayButton()};closeOtherMenus=e=>{"settings"===e?this.volumeContainer.classList.contains("active")&&this.volumeContainer.classList.remove("active"):"volume"===e&&this.settingsMenu.parentElement.classList.contains(this.SHOW_CLASS)&&this.settingsMenu.parentElement.classList.remove(this.SHOW_CLASS),this.updateTabIndices()}}function createControlsUI(e,t){if(e.querySelector("#sigma__controls"))return;const i=document.createElement("div");i.id="sigma__loading-spinner",i.className="sigma__spinner",e.appendChild(i),t.loadingSpinner=i;const s=document.createElement("button");s.id="sigma__central-play",s.className="sigma__central-play-button",s.setAttribute("tabindex","0");const n=getIcon("play-btn");n.classList.add("sigma__centralPlayIcon"),s.appendChild(n),e.appendChild(s);const o=document.createElement("div");o.id="sigma__controls-wrapper",o.className="sigma__control-wrapper";const a=document.createElement("div");a.className="sigma__controls sigma__controlsInner";const l=document.createElement("button");l.id="sigma__play-pause",l.setAttribute("tabindex","0");const d=getIcon("play");d.classList.add("sigma__playIcon");const r=getIcon("pause");r.classList.add("sigma__pauseIcon"),l.appendChild(d),l.appendChild(r),a.appendChild(l);const h=document.createElement("div");h.className="sigma__timeline-container",h.setAttribute("tabindex","0");const c=document.createElement("div");c.id="sigma__timeline",c.className="sigma__timeline-spacer";const u=document.createElement("div");u.className="sigma__full-timeline";const p=document.createElement("div");p.className="sigma__buffered";const m=document.createElement("div");m.id="sigma__progress",u.appendChild(p),u.appendChild(m),c.appendChild(u);const v=document.createElement("div");v.id="sigma__seek-tooltip",v.className="sigma__seek-tooltip",v.textContent="0:00:00",c.appendChild(v),h.appendChild(c);const y=document.createElement("span");y.id="sigma__current-time",y.textContent="0:00:00";const g=document.createElement("span");g.id="sigma__duration",g.textContent="0:00:00",h.appendChild(y),h.appendChild(document.createTextNode(" / ")),h.appendChild(g),a.appendChild(h);const S=document.createElement("div");S.className="sigma__volume-container";const _=document.createElement("button");_.id="sigma__mute",_.className="sigma__isMute",_.setAttribute("tabindex","0");const f=getIcon("volume");f.classList.add("sigma__volumeIcon");const E=getIcon("volume-mute");E.classList.add("sigma__muteIcon"),_.appendChild(f),_.appendChild(E),S.appendChild(_);const b=document.createElement("div");b.id="volume-menu",b.className="sigma__volume-dropdown";const L=document.createElement("input");L.id="sigma__volume-slider",L.type="range",L.style.writingMode="vertical-lr",L.style.direction="rtl",L.min="0",L.max="1",L.step="0.01",L.value="1",L.setAttribute("tabindex","-1"),b.appendChild(L),S.appendChild(b),a.appendChild(S);const C=document.createElement("div");C.className="sigma__dropdown";const T=document.createElement("button");T.id="sigma__settings-btn",T.setAttribute("tabindex","0");const w=getIcon("settings");w.classList.add("sigma__settingsIcon"),T.appendChild(w),C.appendChild(T);const k=document.createElement("div");k.id="sigma__settings-menu",k.className="sigma__dropdown-content";const A=document.createElement("div");A.className="sigma__settings-main";const P=document.createElement("div");P.className="sigma__dropdown-item",P.dataset.menu="speed",P.textContent="Скорость",A.appendChild(P);const I=document.createElement("div");I.className="sigma__dropdown-item",I.dataset.menu="translation",I.textContent="Озвучка",A.appendChild(I);const x=document.createElement("div");x.className="sigma__dropdown-item",x.dataset.menu="quality",x.textContent="Качество",A.appendChild(x);const M=document.createElement("div");M.className="sigma__settings-submenu",M.style.display="none",k.appendChild(A),k.appendChild(M),C.appendChild(k),a.appendChild(C),P.addEventListener("click",(()=>{t.showSubmenu("speed")})),I.addEventListener("click",(()=>{t.showSubmenu("translation")})),x.addEventListener("click",(()=>{t.showSubmenu("quality")}));const N=document.createElement("button");N.id="sigma__full-screen",N.setAttribute("tabindex","0");const B=getIcon("fullscreen");B.classList.add("sigma__fullscreenIcon");const D=getIcon("fullscreen-exit");D.classList.add("sigma__minimiseIcon"),N.appendChild(B),N.appendChild(D),a.appendChild(N),o.appendChild(a),e.appendChild(o),t.centralPlayBtn=e.querySelector("#sigma__central-play"),t.seekTooltip=e.querySelector("#sigma__seek-tooltip"),t.videoWrapper=e,t.controls=e.querySelector("#sigma__controls-wrapper"),t.playBtn=e.querySelector("#sigma__play-pause"),t.volumeBtn=e.querySelector("#sigma__mute"),t.fullScreenBtn=N,t.timeline=e.querySelector("#sigma__timeline"),t.progress=e.querySelector("#sigma__progress"),t.currentTimeElem=e.querySelector("#sigma__current-time"),t.durationElem=e.querySelector("#sigma__duration"),t.volumeContainer=S,t.volumeMenu=b,t.volumeSlider=L,t.settingsBtn=T,t.settingsMenu=k,t.settingsMain=A,t.settingsSubmenu=M}function formatTime(e){const t=Math.floor(e/3600),i=Math.floor(e%3600/60),s=Math.floor(e%60);return t>0?`${t}:${i<10?"0":""}${i}:${s<10?"0":""}${s}`:`${i}:${s<10?"0":""}${s}`}function getIcon(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","sigma__icon"),t.setAttribute("width","24"),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24");const i=document.createElementNS("http://www.w3.org/2000/svg","use");return i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",`#${e}`),t.appendChild(i),t}function getNetworkSpeed(){return navigator.connection&&navigator.connection.downlink?navigator.connection.downlink:5}function chooseQualityBasedOnSpeed(){const e=getNetworkSpeed();return e>5?"1080":e>2.5?"720":e>1?"480":"360"}function getStoredQuality(){return localStorage.getItem("sigma-preferredQuality")}function storeQuality(e){localStorage.setItem("sigma-preferredQuality",e)}function getStoredSpeed(){const e=localStorage.getItem("sigma-playbackSpeed");return e?parseFloat(e):1}function storeSpeed(e){localStorage.setItem("sigma-playbackSpeed",e)}SigmaPlayer.prototype.handleDoubleClick=function(e){if(e.target.closest("#sigma__controls-wrapper"))return;const t=this.videoWrapper.getBoundingClientRect();e.clientX-t.left<t.width/2?this.video.currentTime=Math.max(0,this.video.currentTime-10):this.video.currentTime=Math.min(this.video.duration,this.video.currentTime+10)},SigmaPlayer.prototype.handleMouseDown=function(e){e.target.closest("#sigma__controls-wrapper")||(this.longPressTimeout=setTimeout((()=>{this.video.playbackRate=2,this.longPressActivated=!0}),3e3))},SigmaPlayer.prototype.handleMouseUp=function(e){clearTimeout(this.longPressTimeout),this.longPressActivated&&(this.video.playbackRate=1,this.longPressActivated=!1)},SigmaPlayer.prototype.initialize=function(){this.video.addEventListener("play",(()=>{this.playBtn.classList.add(this.IS_PLAYING_CLASS),this.hideSpinner()})),this.video.addEventListener("pause",(()=>{this.playBtn.classList.remove(this.IS_PLAYING_CLASS),this.hideSpinner()})),this.video.addEventListener("ended",(()=>{this.playBtn.classList.remove(this.IS_PLAYING_CLASS),this.showControls(),this.hideSpinner()})),this.video.addEventListener("waiting",this.showSpinner),this.video.addEventListener("playing",this.hideSpinner),this.video.addEventListener("pause",this.showCentralPlay),this.video.addEventListener("play",this.hideCentralPlay),this.video.addEventListener("ended",this.showCentralPlay),this.disablePlayButton();const e=localStorage.getItem("volume");if(null!==e){const t=parseFloat(e);this.video.volume=t,this.volumeSlider.value=t,0===t?(this.video.muted=!0,this.volumeBtn.classList.add(this.IS_MUTED_CLASS)):(this.video.muted=!1,this.volumeBtn.classList.remove(this.IS_MUTED_CLASS))}else this.video.volume=1,this.volumeSlider.value=1;const t=this.getStoredSpeed();this.video.playbackRate=t,this.playBtn.addEventListener("click",(()=>{this.playEnabled?this.togglePlayState():alert("Пожалуйста, выберите озвучку и качество перед воспроизведением.")})),this.centralPlayBtn.addEventListener("click",(()=>{this.playEnabled&&this.togglePlayState()})),this.fullScreenBtn.addEventListener("click",this.toggleFullscreen),this.video.addEventListener("timeupdate",this.updateProgress),this.video.addEventListener("loadedmetadata",(()=>{this.updateTimeDisplay()})),this.video.addEventListener("sigma__progress",this.updateBuffered),this.timeline.addEventListener("click",this.handleTimelineClick),this.timeline.addEventListener("mousedown",this.startDrag),document.addEventListener("mouseup",this.stopDrag),document.addEventListener("mousemove",this.dragTimeline),this.timeline.addEventListener("touchstart",this.startDrag),document.addEventListener("touchend",this.stopDrag),document.addEventListener("touchmove",this.dragTimeline),this.volumeBtn.addEventListener("click",(e=>{e.stopPropagation(),this.toggleVolume()})),document.addEventListener("click",(e=>{if(!e.target.closest(".sigma__dropdown")){let e=this.settingsMenu.parentElement;e.classList.contains(this.SHOW_CLASS)&&(e.classList.remove(this.SHOW_CLASS),this.updateTabIndices())}})),document.addEventListener("fullscreenchange",(()=>{document.fullscreenElement||(this.fullScreenBtn.classList.remove(this.IS_FULLSCREEN_CLASS),this.video.style.position="",this.video.style.top="",this.video.style.left="",this.video.style.transform="",this.video.style.maxWidth="",this.video.style.maxHeight="")})),this.mouseActivityTimeout=null,this.showControls=this.showControls.bind(this),this.hideControls=this.hideControls.bind(this),this.resetMouseActivityTimeout=this.resetMouseActivityTimeout.bind(this),this.videoWrapper.addEventListener("mousemove",this.showControls),this.video.addEventListener("pause",this.showControls),this.video.addEventListener("play",this.resetMouseActivityTimeout),this.videoWrapper.addEventListener("mouseenter",this.showControls),this.videoWrapper.addEventListener("mouseleave",this.hideControls),this.controls.addEventListener("mousemove",this.showControls),this.controls.addEventListener("mouseenter",this.showControls),this.controls.addEventListener("mouseleave",this.resetMouseActivityTimeout),this.videoWrapper.addEventListener("touchstart",this.showControls),this.videoWrapper.addEventListener("touchend",(()=>{setTimeout(this.hideControls,5e3)})),this.resetMouseActivityTimeout(),this.settingsBtn.addEventListener("click",this.toggleSettingsMenuFunc),this.videoWrapper.addEventListener("dblclick",this.handleDoubleClick),this.videoWrapper.addEventListener("mousedown",this.handleMouseDown),this.videoWrapper.addEventListener("touchstart",this.handleMouseDown),this.videoWrapper.addEventListener("mouseup",this.handleMouseUp),this.videoWrapper.addEventListener("touchend",this.handleMouseUp),this.videoWrapper.addEventListener("mouseleave",this.handleMouseUp),this.settingsMenu.addEventListener("keydown",(e=>{const t=Array.from(this.settingsMenu.querySelectorAll(".sigma__dropdown-item")).filter((e=>"0"===e.getAttribute("tabindex")));if(0===t.length)return;const i=t.indexOf(document.activeElement);if("ArrowDown"===e.key){e.preventDefault();t[(i+1)%t.length].focus()}else if("ArrowUp"===e.key){e.preventDefault();t[(i-1+t.length)%t.length].focus()}else"Escape"===e.key&&(this.settingsMenu.parentElement.classList.remove(this.SHOW_CLASS),this.updateTabIndices(),this.settingsBtn.focus())}))},SigmaPlayer.prototype.selectQuality=function(e,t=!0){const i=this.video.currentTime;if(this.showSpinner(),this.autoQuality){const e=this.videoSources[this.selectedTranslation].auto;if(!e)return console.warn("Sources are not available"),void this.hideSpinner();const t=e.split("?")[0];if(this.videoType||(t.endsWith(".m3u8")?this.videoType="hls":t.endsWith(".mpd")?this.videoType="dash":this.videoType="mp4"),"hls"===this.videoType){if("undefined"==typeof Hls)return console.warn("hls.js not available"),void this.hideSpinner();t.endsWith(".m3u8")?(this.hls&&(this.hls.destroy(),this.hls=null),this.hls=new Hls({maxMaxBufferLength:30,maxBufferSize:5242880,maxBufferLength:30}),this.hls.attachMedia(this.video),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.hls.loadSource(e)})),this.hls.on(Hls.Events.MANIFEST_PARSED,(()=>{this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()}))}))):(this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner())}else if("dash"===this.videoType){if("undefined"==typeof dashjs)return console.warn("dash.js not available"),void this.hideSpinner();t.endsWith(".mpd")?(this.dashPlayer&&(this.dashPlayer.reset(),this.dashPlayer=null),this.dashPlayer=dashjs.MediaPlayer().create(),this.dashPlayer.initialize(this.video,e,!1),this.dashPlayer.on(dashjs.MediaPlayer.events.MANIFEST_LOADED,(()=>{this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()}))}))):(this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner())}else this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner()}else{if(!this.selectedTranslation)return console.warn("Пожалуйста, выберите озвучку перед выбором качества."),void this.hideSpinner();if(!this.videoSources[this.selectedTranslation][e])return console.warn("Выбранное качество недоступно."),void this.hideSpinner();t?(this.selectedQuality=e,this.storeQuality(e)):this.selectedQuality=e;const s=this.videoSources[this.selectedTranslation][this.selectedQuality];if(s&&s.length>0){const e=s[0],t=e.split("?")[0];if(this.videoType||(t.endsWith(".m3u8")?this.videoType="hls":t.endsWith(".mpd")?this.videoType="dash":this.videoType="mp4"),"hls"===this.videoType){if("undefined"==typeof Hls)return console.warn("hls.js не найден"),void this.hideSpinner();t.endsWith(".m3u8")?(this.hls&&(this.hls.destroy(),this.hls=null),this.hls=new Hls({maxMaxBufferLength:30,maxBufferSize:5242880,maxBufferLength:30}),this.hls.attachMedia(this.video),this.hls.on(Hls.Events.MEDIA_ATTACHED,(()=>{this.hls.loadSource(e)})),this.hls.on(Hls.Events.MANIFEST_PARSED,(()=>{this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()}))}))):(this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner())}else if("dash"===this.videoType){if("undefined"==typeof dashjs)return console.warn("dash.js не найден"),void this.hideSpinner();t.endsWith(".mpd")?(this.dashPlayer&&(this.dashPlayer.reset(),this.dashPlayer=null),this.dashPlayer=dashjs.MediaPlayer().create(),this.dashPlayer.initialize(this.video,e,!1),this.dashPlayer.setAutoSwitchQuality(!1),this.dashPlayer.on(dashjs.MediaPlayer.events.MANIFEST_LOADED,(()=>{this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()}))}))):(this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner())}else this.video.src=e,this.video.currentTime=i,this.video.play().catch((e=>{console.error("Error playing video:",e),this.hideSpinner()})),this.hideSpinner()}else console.warn("Не удалось установить источник видео."),this.hideSpinner()}},SigmaPlayer.prototype.selectQualityAuto=function(e){"hls"===this.videoType?this.hls&&(this.hls.currentLevel=e,this.updateAutoQualityUI(),this.storeQuality(e)):"dash"===this.videoType&&this.dashPlayer&&(-1===e?this.dashPlayer.setAutoSwitchQuality(!0):(this.dashPlayer.setAutoSwitchQuality(!1),this.dashPlayer.setQualityFor("video",e)),this.storeQuality(e))},SigmaPlayer.prototype.updateAutoQualityUI=function(){if("hls"===this.videoType&&this.hls){this.settingsSubmenu.querySelectorAll("[data-level]").forEach((e=>{parseInt(e.dataset.level)===this.hls.currentLevel?e.classList.add("active"):e.classList.remove("active")}))}},SigmaPlayer.prototype.populateQualityOptionsAuto=function(){},SigmaPlayer.prototype.populateTranslationOptions=function(){const e=Object.keys(this.videoSources),t=this.settingsMenu.querySelector(".sigma__settings-main [data-menu='translation']");if(e.length<=1){if(t&&(t.style.display="none"),1===e.length){if(this.selectedTranslation=e[0],this.autoQuality)this.populateQualityOptionsAuto(),this.selectQuality("auto",!1);else{let e=this.getStoredQuality();if(e&&this.videoSources[this.selectedTranslation][e]||(e=this.chooseQualityBasedOnSpeed()),this.videoSources[this.selectedTranslation][e])this.selectQuality(e,!1);else{const t=Object.keys(this.videoSources[this.selectedTranslation]).sort(((e,t)=>parseInt(t)-parseInt(e)));e=t.find((t=>parseInt(t)<=parseInt(e)))||t[0],this.selectQuality(e,!1)}}this.playEnabled=!0,this.enablePlayButton()}}else this.selectTranslation(e[0])},SigmaPlayer.prototype.selectTranslation=function(e){this.selectedTranslation=e,this.playEnabled=!0,this.enablePlayButton()},SigmaPlayer.prototype.loadVideoSources=function(e){if("string"==typeof e)this.autoQuality=!0,this.videoSources={default:{auto:e}};else if("object"==typeof e){let t=!1;for(let i in e)if("string"==typeof e[i]){t=!0;break}t?(this.autoQuality=!1,this.videoSources={default:e}):(this.autoQuality=!1,this.videoSources=e)}this.populateTranslationOptions()},SigmaPlayer.prototype.showControls=function(){this.controls.classList.remove(this.HIDE_CONTROLS_CLASS),this.resetMouseActivityTimeout()},SigmaPlayer.prototype.hideControls=function(){this.isMenuOpen()||this.video.paused||this.video.ended||this.controls.classList.add(this.HIDE_CONTROLS_CLASS)},SigmaPlayer.prototype.resetMouseActivityTimeout=function(){if(clearTimeout(this.mouseActivityTimeout),!this.video.paused&&!this.video.ended){const e="ontouchstart"in window?5e3:3e3;this.mouseActivityTimeout=setTimeout((()=>{this.hideControls()}),e)}},SigmaPlayer.prototype.hideSubmenu=function(){this.settingsSubmenu.style.display="none",this.settingsSubmenu.innerHTML="",this.settingsMain.style.display="block"},SigmaPlayer.prototype.showSubmenu=function(e){this.settingsMain.style.display="none",this.settingsSubmenu.style.display="block",this.settingsSubmenu.innerHTML="";const t=document.createElement("div");t.className="sigma__dropdown-item sigma__back-button";const i=getIcon("back");i.classList.add("sigma__backIcon"),t.appendChild(i),t.appendChild(document.createTextNode(" "+("speed"===e?"Скорость":"translation"===e?"Озвучка":"Качество"))),t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{this.hideSubmenu()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),this.settingsSubmenu.appendChild(t),"speed"===e?this.populateSpeedSubmenu():"translation"===e?this.populateTranslationSubmenu():"quality"===e&&this.populateQualitySubmenu()},SigmaPlayer.prototype.populateSpeedSubmenu=function(){[{speed:.5,label:"0.5x"},{speed:1,label:"1.0x"},{speed:2,label:"2.0x"}].forEach((e=>{const t=document.createElement("div");t.className="sigma__dropdown-item sigma__speed-option",t.dataset.speed=e.speed,t.textContent=e.label,t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{this.setPlaybackSpeed(e.speed),this.hideSubmenu()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),this.settingsSubmenu.appendChild(t)}))},SigmaPlayer.prototype.populateTranslationSubmenu=function(){Object.keys(this.videoSources).forEach((e=>{const t=document.createElement("div");t.className="sigma__dropdown-item",t.dataset.translation=e,t.textContent=e,t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{this.selectTranslation(e),this.hideSubmenu()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),this.settingsSubmenu.appendChild(t)}))},SigmaPlayer.prototype.populateQualitySubmenu=function(){if(this.autoQuality){if("dash"===this.videoType){if("undefined"==typeof dashjs){const e=document.createElement("div");return e.className="sigma__dropdown-item",e.textContent="dash.js не найден",void this.settingsSubmenu.appendChild(e)}if(!this.dashPlayer){const e=document.createElement("div");return e.className="sigma__dropdown-item",e.textContent="Нет доступных качеств",void this.settingsSubmenu.appendChild(e)}const e=document.createElement("div");e.className="sigma__dropdown-item",e.textContent="Авто",e.dataset.level=-1,e.setAttribute("tabindex","0"),e.addEventListener("click",(()=>{this.selectQualityAuto(-1),this.hideSubmenu()})),e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})),this.settingsSubmenu.appendChild(e);const t=this.dashPlayer.getBitrateInfoListFor("video"),i=new Map;t.forEach((e=>{let t=e.height?e.height+"p":`${e.bitrate}`;i.has(t)||i.set(t,e.qualityIndex)})),i.forEach(((e,t)=>{const i=document.createElement("div");i.className="sigma__dropdown-item",i.textContent=t,i.dataset.level=e,i.setAttribute("tabindex","0"),i.addEventListener("click",(()=>{this.selectQualityAuto(parseInt(i.dataset.level)),this.hideSubmenu()})),i.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i.click())})),this.settingsSubmenu.appendChild(i)}))}else if("hls"===this.videoType){if("undefined"==typeof Hls){const e=document.createElement("div");return e.className="sigma__dropdown-item",e.textContent="hls.js не найден",void this.settingsSubmenu.appendChild(e)}if(!this.hls||!this.hls.levels||0===this.hls.levels.length){const e=document.createElement("div");return e.className="sigma__dropdown-item",e.textContent="Нет доступных качеств",void this.settingsSubmenu.appendChild(e)}const e=document.createElement("div");e.className="sigma__dropdown-item",e.textContent="Авто",e.dataset.level=-1,e.setAttribute("tabindex","0"),e.addEventListener("click",(()=>{this.selectQualityAuto(-1),this.hideSubmenu()})),e.addEventListener("keydown",(t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})),this.settingsSubmenu.appendChild(e);const t=this.hls.levels,i=new Map;t.forEach(((e,t)=>{let s=e.height?e.height+"p":`${e.bitrate}`;i.has(s)||i.set(s,t)})),i.forEach(((e,t)=>{const i=document.createElement("div");i.className="sigma__dropdown-item",i.textContent=t,i.dataset.level=e,i.setAttribute("tabindex","0"),i.addEventListener("click",(()=>{this.selectQualityAuto(parseInt(i.dataset.level)),this.hideSubmenu()})),i.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),i.click())})),this.settingsSubmenu.appendChild(i)}))}}else{if(!this.selectedTranslation){const e=document.createElement("div");return e.className="sigma__dropdown-item",e.textContent="Нет озвучки",void this.settingsSubmenu.appendChild(e)}Object.keys(this.videoSources[this.selectedTranslation]).sort(((e,t)=>parseInt(t)-parseInt(e))).forEach((e=>{const t=document.createElement("div");t.className="sigma__dropdown-item",t.textContent=e,t.dataset.quality=e,t.setAttribute("tabindex","0"),t.addEventListener("click",(()=>{this.selectQuality(e),this.hideSubmenu()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),this.settingsSubmenu.appendChild(t)}))}};